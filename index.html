<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SBAR Automatizado - UTI</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1, h2 {
      color: #2c3e50;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea {
      resize: vertical;
    }
    button {
      background-color: #2980b9;
      color: white;
      padding: 10px 20px;
      margin: 10px 10px 0 0;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #resultado {
      white-space: pre-wrap;
      background-color: #fff;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 20px;
    }
    #utiCampos, #viaAereaDetalhada {
      display: none;
      margin-left: 15px;
      border-left: 3px solid #2980b9;
      padding-left: 10px;
      margin-bottom: 12px;
    }
    .checkbox-group {
      margin-bottom: 12px;
    }
    .checkbox-group label {
      font-weight: normal;
      display: inline-block;
      margin-right: 15px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>SBAR Automatizado - Passagem para UTI</h1>

<h2>üü¢ Situa√ß√£o</h2>

<label>Nome do paciente:</label>
<input type="text" id="nome" placeholder="Ex: Pedro" />

<label>Idade:</label>
<input type="number" id="idade" placeholder="Ex: 42" />

<label>Sexo:</label>
<select id="sexo">
  <option value="">Selecione</option>
  <option value="masculino">Masculino</option>
  <option value="feminino">Feminino</option>
</select>

<label>Motivo da interna√ß√£o:</label>
<input type="text" id="motivo" placeholder="Ex: Abdome agudo, trauma tor√°cico, TCE,..." />

<label>Origem do paciente:</label>
<select id="origem" onchange="toggleUTICampos()">
  <option value="">Selecione</option>
  <option value="emergencia">Setor de Emerg√™ncia</option>
  <option value="enfermaria">Enfermaria</option>
  <option value="uti">UTI</option>
</select>

<div id="utiCampos">
  <div class="checkbox-group">
    <input type="checkbox" id="intubado" />
    <label for="intubado">Intubado</label>
  </div>

  <label>Tipo de ventila√ß√£o:</label>
  <select id="tipoVentilacao">
    <option value="">Selecione</option>
    <option>Ventila√ß√£o mec√¢nica</option>
    <option>Ar ambiente</option>
    <option>Oxig√™nio suplementar</option>
    <option>Traqueostomia</option>
  </select>

  <label>Drogas vasoativas em uso (marque as que se aplicam):</label>
  <select id="drogasVasoativas" multiple>
    <option value="Noradrenalina">Noradrenalina</option>
    <option value="Vasopressina">Vasopressina</option>
    <option value="Dobutamina">Dobutamina</option>
    <option value="Nitroprussiato">Nitroprussiato</option>
    <option value="Nitroglicerina">Nitroglicerina</option>
    <option value="Outros">Outros</option>
  </select>

  <label>Se marcou "Outros", especifique:</label>
  <input type="text" id="drogasOutros" placeholder="Descreva outras drogas vasoativas" />

  <label>Seda√ß√£o:</label>
  <select id="sedacaoUTI">
    <option value="">Selecione</option>
    <option>Plano profundo</option>
    <option>Consciente</option>
  </select>

  <div class="checkbox-group">
    <input type="checkbox" id="monitorizado" />
    <label for="monitorizado">Monitorizado</label>
  </div>

  <div id="viaAereaDetalhada">
    <h3>Detalhes da via a√©rea</h3>

    <label>Sequ√™ncia:</label>
    <select id="sequencia">
      <option>R√°pida</option>
      <option>Lenta</option>
      <option>Atrasada</option>
    </select>

    <label>N√∫mero do tubo:</label>
    <input type="text" id="numTubo" placeholder="Ex: 7.5" />

    <div class="checkbox-group">
      <input type="checkbox" id="aramado" checked />
      <label for="aramado">Aramado</label>
    </div>

    <label>Dispositivo:</label>
    <select id="dispositivo">
      <option>Laringosc√≥pio</option>
      <option>Videolaringosc√≥pio</option>
      <option>Fibrosc√≥pio</option>
    </select>

    <label>Cormack:</label>
    <input type="text" id="cormack" placeholder="Ex: I, II, III, IV" />

    <div class="checkbox-group">
      <input type="checkbox" id="bougie" checked />
      <label for="bougie">Uso de bougie</label>
    </div>

    <label>Intercorr√™ncias:</label>
    <input type="text" id="intercorrenciasViaAerea" placeholder="Descreva aqui..." />
  </div>
</div>

<label>Procedimento realizado:</label>
<input type="text" id="procedimento" placeholder="Laparotomia exploradora, Apendicectomia,..." />

<label>Urg√™ncia do procedimento:</label>
<select id="urgencia">
  <option>Emerg√™ncia</option>
  <option>Urg√™ncia</option>
  <option>Eletivo</option>
</select>

<!-- üî∑ Background -->
<h2>üî∑ Background</h2>

<label>ASA (classifica√ß√£o f√≠sica):</label>
<select id="asa">
  <option value="">Selecione</option>
  <option>I</option>
  <option>II</option>
  <option>III</option>
  <option>IV</option>
  <option>V</option>
  <option>VI</option>
</select>

<label>Status do jejum:</label>
<select id="jejum">
  <option value="">Selecione</option>
  <option>S√≥lidos <6h</option>
  <option>L√≠quidos claros <2h</option>
  <option>Jejum adequado</option>
  <option>Outro</option>
</select>

<label>Monitoriza√ß√£o:</label>
<select id="monitorizacao" multiple>
  <option>ECG</option>
  <option>SpO‚ÇÇ</option>
  <option>Press√£o arterial n√£o invasiva</option>
  <option>Press√£o arterial invasiva</option>
  <option>Capnografia</option>
  <option>BIS</option>
  <option>Temperatura</option>
  <option>Outros</option>
</select>

<label>Peso do paciente (kg):</label>
<input type="number" id="peso" placeholder="Ex: 70" />

<label>Altura (cm):</label>
<input type="number" id="altura" placeholder="Ex: 175" />

<label>Alergias:</label>
<input type="text" id="alergias" placeholder="Ex: Penicilina, Sulfa..." />

<label>Comorbidades (marque as que se aplicam):</label>
<select id="comorbidades" multiple>
  <option value="hipertenso">Hipertens√£o</option>
  <option value="diabetes n√£o insulinodependente">Diabetes n√£o insulinodependente</option>
  <option value="diabetes insulinodependente">Diabetes insulinodependente</option>
  <option value="doen√ßa arterial coronariana">Doen√ßa Arterial Coronariana</option>
  <option value="DPOC">DPOC</option>
  <option value="IRC">Doen√ßa Renal Cr√¥nica</option>
  <option value="outros">Outros</option>
</select>

<label>Cirurgias pr√©vias:</label>
<input type="text" id="cirurgias" placeholder="Ex: Revasculariza√ß√£o do mioc√°rdio" />

<label>Medica√ß√µes em uso:</label>
<input type="text" id="medicacoes" placeholder="Ex: Losartana, Metformina, AAS..." />

<!-- üü† Avalia√ß√£o -->
<h2>üü† Avalia√ß√£o</h2>

<label>Tipo de anestesia:</label>
<select id="anestesia">
  <option>Geral balanceada</option>
  <option>Geral venosa total (TIVA)</option>
  <option>Raquianestesia</option>
  <option>Peridural</option>
  <option>Outros</option>
</select>

<label>Indu√ß√£o anest√©sica:</label>
<input type="text" id="indu√ßao" placeholder="Ex: Sequ√™ncia r√°pida, sem intercorr√™ncias" />

<label>Via a√©rea:</label>
<select id="viaAerea">
  <option>Cormack-Lehane I</option>
  <option>Cormack-Lehane II</option>
  <option>Cormack-Lehane III-IV</option>
</select>

<label>Hemodin√¢mica:</label>
<input type="text" id="hemodinamica" placeholder="Ex: Noradrenalina 0,2 mcg/kg/min" />

<label>Respira√ß√£o:</label>
<input type="text" id="respiracao" placeholder="Ex: Ventila√ß√£o mec√¢nica durante transoperat√≥rio" />

<label>Renal:</label>
<input type="text" id="renal" placeholder="Ex: 2500ml de cristaloide, 500ml de diurese" />

<label>Infeccioso:</label>
<input type="text" id="infeccao" placeholder="Ex: Febre intraoperat√≥ria, Ceftriaxona 13:00" />

<label>Hematol√≥gico:</label>
<input type="text" id="hemato" placeholder="Ex: 1 concentrado de hem√°cias" />

<label>End√≥crino:</label>
<input type="text" id="endocrino" placeholder="Ex: Euglic√™mico" />

<label>Dispositivos (marque os presentes):</label>
<select id="dispositivos" multiple>
  <option value="CVC">CVC</option>
  <option value="Acesso perif√©rico">Acesso perif√©rico</option>
  <option value="Dreno cir√∫rgico">Dreno cir√∫rgico</option>
  <option value="TOT">Tubo orotraqueal</option>
  <option value="SVD">SVD</option>
  <option value="AVP">AVP</option>
</select>

<!-- üî¥ Recomenda√ß√£o -->
<h2>üî¥ Recomenda√ß√£o</h2>

<label>Transporte:</label>
<select id="transporte">
  <option>Monitoriza√ß√£o cont√≠nua</option>
  <option>Monitoriza√ß√£o e uso de drogas vasoativas</option>
</select>

<label>Seda√ß√£o:</label>
<select id="sedacao">
  <option>Sedado</option>
  <option>Despertando</option>
  <option>Acordado</option>
</select>

<label>Ventila√ß√£o:</label>
<select id="ventilacao">
  <option>Em ventila√ß√£o mec√¢nica</option>
  <option>Espontaneamente</option>
</select>

<label>Intercorr√™ncias durante transporte:</label>
<input type="text" id="intercorrencias" placeholder="Ex: Nenhuma" />

<!-- ‚úÖ Bot√µes -->
<br>
<button onclick="gerarSBAR()">Gerar Relat√≥rio</button>
<button onclick="copiarTexto()">Copiar Relat√≥rio</button>
<button onclick="gerarPDF()">Gerar PDF</button>

<!-- üìú Resultado -->
<h2>üìù Relat√≥rio Gerado</h2>
<div id="resultado"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  let textoGerado = "";

  function toggleUTICampos() {
    const origem = document.getElementById("origem").value;
    const utiCampos = document.getElementById("utiCampos");
    if (origem === "uti") {
      utiCampos.style.display = "block";
    } else {
      utiCampos.style.display = "none";
      document.getElementById("intubado").checked = false;
      document.getElementById("tipoVentilacao").value = "";
      document.getElementById("drogasVasoativas").selectedIndex = -1;
      document.getElementById("drogasOutros").value = "";
      document.getElementById("sedacaoUTI").value = "";
      document.getElementById("monitorizado").checked = false;
      document.getElementById("viaAereaDetalhada").style.display = "none";

      document.getElementById("sequencia").value = "R√°pida";
      document.getElementById("numTubo").value = "";
      document.getElementById("aramado").checked = true;
      document.getElementById("dispositivo").value = "Laringosc√≥pio";
      document.getElementById("cormack").value = "";
      document.getElementById("bougie").checked = true;
      document.getElementById("intercorrenciasViaAerea").value = "";
    }
  }

  function toggleViaAereaDetalhada() {
    const intubado = document.getElementById("intubado").checked;
    const viaAereaDetalhada = document.getElementById("viaAereaDetalhada");
    if (!intubado) {
      viaAereaDetalhada.style.display = "block";
    } else {
      viaAereaDetalhada.style.display = "none";

      document.getElementById("sequencia").value = "R√°pida";
      document.getElementById("numTubo").value = "";
      document.getElementById("aramado").checked = true;
      document.getElementById("dispositivo").value = "Laringosc√≥pio";
      document.getElementById("cormack").value = "";
      document.getElementById("bougie").checked = true;
      document.getElementById("intercorrenciasViaAerea").value = "";
    }
  }

  function calcularPesoIdeal(altura, sexo) {
    if (sexo === "masculino") {
      return 52 + 0.75 * (altura - 152);
    } else if (sexo === "feminino") {
      return 49 + 0.67 * (altura - 152);
    } else {
      return 0;
    }
  }

  function calcularPesoAjustado(peso, pesoIdeal) {
    return peso + 0.4 * (peso - pesoIdeal);
  }

  function gerarSBAR() {
    const nome = document.getElementById("nome").value;
    const idade = document.getElementById("idade").value;
    const sexo = document.getElementById("sexo").value;
    const motivo = document.getElementById("motivo").value;
    const origem = document.getElementById("origem").value;
    const procedimento = document.getElementById("procedimento").value;
    const urgencia = document.getElementById("urgencia").value;

    const asa = document.getElementById("asa").value;
    const jejum = document.getElementById("jejum").value;

    const monitorizacaoSelected = Array.from(document.getElementById("monitorizacao").selectedOptions).map(opt => opt.value);
    const monitorizacaoTexto = monitorizacaoSelected.length > 0 ? monitorizacaoSelected.join(", ") : "n√£o informado";

    const comorbidades = Array.from(document.getElementById("comorbidades").selectedOptions).map(o => o.value).join(", ") || "n√£o informadas";
    const cirurgias = document.getElementById("cirurgias").value || "n√£o informadas";
    const medicacoes = document.getElementById("medicacoes").value || "n√£o informadas";

    const anestesia = document.getElementById("anestesia").value;
    const inducao = document.getElementById("indu√ßao").value;
    const viaAerea = document.getElementById("viaAerea").value;
    const hemodinamica = document.getElementById("hemodinamica").value;
    const respiracao = document.getElementById("respiracao").value;
    const renal = document.getElementById("renal").value;
    const infeccao = document.getElementById("infeccao").value;
    const hemato = document.getElementById("hemato").value;
    const endocrino = document.getElementById("endocrino").value;
    const dispositivos = Array.from(document.getElementById("dispositivos").selectedOptions).map(o => o.value).join(", ") || "n√£o informados";

    const transporte = document.getElementById("transporte").value;
    const sedacao = document.getElementById("sedacao").value;
    const ventilacao = document.getElementById("ventilacao").value;
    const intercorrencias = document.getElementById("intercorrencias").value;

    const pesoPaciente = parseFloat(document.getElementById("peso").value);
    const alturaPaciente = parseFloat(document.getElementById("altura").value);
    const alergias = document.getElementById("alergias").value || "n√£o informadas";

    // C√°lculos peso ideal e ajustado
    const pesoIdeal = calcularPesoIdeal(alturaPaciente, sexo);
    const pesoAjustado = calcularPesoAjustado(pesoPaciente, pesoIdeal);

    // Dados da UTI se aplic√°vel
    let textoUTI = "";
    if (origem === "uti") {
      const intubado = document.getElementById("intubado").checked;
      const tipoVentilacao = document.getElementById("tipoVentilacao").value;
      const drogasVasoativas = Array.from(document.getElementById("drogasVasoativas").selectedOptions).map(o => o.value);
      const drogasOutros = document.getElementById("drogasOutros").value.trim();
      const sedacaoUTI = document.getElementById("sedacaoUTI").value;
      const monitorizado = document.getElementById("monitorizado").checked;

      if (drogasVasoativas.includes("Outros") && drogasOutros) {
        const idx = drogasVasoativas.indexOf("Outros");
        drogasVasoativas[idx] = `Outros: ${drogasOutros}`;
      }

      textoUTI = `Paciente vem da UTI${intubado ? ` intubado em IOT + ${tipoVentilacao}` : `, n√£o intubado, em ${tipoVentilacao}`}${sedacaoUTI ? `, sedado em ${sedacaoUTI}` : ""}${monitorizado ? `, monitorizado` : ""}${drogasVasoativas.length ? `, em uso de ${drogasVasoativas.join(", ")}` : ""}.`;
    }

    // Texto natural para origem n√£o UTI
    let origemTexto = "";
    if (origem === "emergencia") origemTexto = "Paciente vem do Setor de Emerg√™ncia.";
    else if (origem === "enfermaria") origemTexto = "Paciente vem da Enfermaria.";
    else if (origem === "") origemTexto = "Origem do paciente n√£o informada.";

    // Texto via a√©rea detalhada se n√£o intubado e UTI
    let textoViaAereaDetalhada = "";
    if (origem === "uti" && !document.getElementById("intubado").checked) {
      const sequencia = document.getElementById("sequencia").value.toLowerCase();
      const numTubo = document.getElementById("numTubo").value;
      const aramado = document.getElementById("aramado").checked ? "aramado" : "n√£o aramado";
      const dispositivo = document.getElementById("dispositivo").value.toLowerCase();
      const cormack = document.getElementById("cormack").value;
      const bougie = document.getElementById("bougie").checked ? "com" : "sem";
      const intercorrenciasViaAerea = document.getElementById("intercorrenciasViaAerea").value || "sem intercorr√™ncias";

      textoViaAereaDetalhada = `Paciente submetido √† sequ√™ncia ${sequencia}, intubado com tubo ${aramado} n¬∫ ${numTubo}, utilizando ${dispositivo}, Cormack ${cormack}, ${bougie} bougie, ${intercorrenciasViaAerea}.`;
    }

    textoGerado = `# ${nome}, ${idade} anos, sexo ${sexo}
# Motivo da interna√ß√£o: ${motivo}

# S
${origem === "uti" ? textoUTI : origemTexto}
Paciente com hist√≥ria de ${motivo.toLowerCase()}.
${textoViaAereaDetalhada ? textoViaAereaDetalhada + "\n" : ""}
Vem ao Centro Cir√∫rgico para realiza√ß√£o de ${procedimento.toLowerCase()} em regime de ${urgencia.toLowerCase()}.

# B
ASA: ${asa || "n√£o informada"}.
Status do jejum: ${jejum || "n√£o informado"}.
Monitoriza√ß√£o: ${monitorizacaoTexto}.
Comorbidades: ${comorbidades}.
Cirurgias pr√©vias: ${cirurgias}.
Medica√ß√µes em uso: ${medicacoes}.
Alergias: ${alergias}.
Peso: ${pesoPaciente || "n√£o informado"} kg (ideal ${pesoIdeal ? pesoIdeal.toFixed(1) : "n√£o informado"} kg, ajustado ${pesoAjustado ? pesoAjustado.toFixed(1) : "n√£o informado"} kg).

# A
Realizado anestesia ${anestesia.toLowerCase()}.
Indu√ß√£o anest√©sica: ${inducao}.
Via a√©rea: ${origem === "uti" && document.getElementById("intubado").checked ? "Paciente j√° intubado" : viaAerea}.
Hemodin√¢mica: ${hemodinamica}.
Pulmonar: ${respiracao}.
Renal: ${renal}.
Infeccioso: ${infeccao}.
Hemato: ${hemato}.
End√≥crino: ${endocrino}.
Dispositivos: ${dispositivos}.

# R
Transporte: ${transporte}, ${sedacao}, ${ventilacao}, ${intercorrencias}.
`;

    document.getElementById("resultado").textContent = textoGerado;
  }

  function copiarTexto() {
    if (!textoGerado) return alert("Gere o relat√≥rio primeiro.");
    navigator.clipboard.writeText(textoGerado)
      .then(() => alert("Relat√≥rio copiado para a √°rea de transfer√™ncia!"))
      .catch(() => alert("Erro ao copiar. Copie manualmente."));
  }

  async function gerarPDF() {
    if (!textoGerado) return alert("Gere o relat√≥rio primeiro.");

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const linhas = textoGerado.split('\n');
    let y = 10;

    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);

    linhas.forEach(linha => {
      if (y > 280) {
        doc.addPage();
        y = 10;
      }
      doc.text(linha, 10, y);
      y += 8;
    });

    doc.save("relatorio-sbar.pdf");
  }
</script>

</body>
</html>
